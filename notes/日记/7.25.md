- 理解脏读 （read uncommited)
- 理解脏写
- 理解幻读约等于（不可重复读）（repeatable read）
    - 幻读解决办法是间隙锁，mysql是基于索引的，所以如果update了不带索引的语句，相当于锁了全表，性能极低
- 理解更新丢失和写入偏斜
- 理解物化视图
    - 缓存求和结果，如SUM,AVG,COUNT等
    - 与虚拟视图不同，物化视图是实际的数据库副本
- 复杂SQL
``` SQL
// get the 10 max average score of each student
SELECT student_id, AVG(score) AS avg_score
FROM scores
GROUP BY student_id
ORDER BY avg_score DESC
LIMIT 10;

// the table show the grades. It contains the student ID and a date.
// you want to find the average grade per student and year.
SELECT student_id, YEAR(date) AS year, AVG(score) AS avg_score
FROM scores
GROUP BY student_id, YEAR(date)

// use this to get the tio student per year via window function (max over)
SELECT year, student_id, agv_score
FROM (
    SELECT 
        student_id, YEAR(date) AS year, AVG(score) AS avg_score,
        MAX(AVG(score)) OVER (PARTITION BY YEAR(date)) AS max_avg_score
    FROM scores
    GROUP BY student_id, YEAR(date)
) aggregated
WHERE avg_score = max_avg_score
ORDER BY year, student_id;
```
- the end